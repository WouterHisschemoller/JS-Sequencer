/**
 * View is a layer between the HTML and the rest of the application.
 * It updates the view to represent the app state and
 * passes DOM events generated by the user to the app.
 *
 * @namespace WH
 */
window.WH = window.WH || {};

(function (WH) {

    /**
     * @constructor
     */
    function createFile() {

        var that,
            settings = {
                projectName: 'project'
            },

            /**
             * Autosave file if true.
             * @type {Boolean}
             */
            autoSaveEnabled = true,

            /**
             * Autosave file if true.
             * @type {Object}
             */
            project = null,

            /**
             * Create a new arrangement.
             * @param {Boolean} isRandom If true create a randomized project.
             */
            createNew = function(isRandom) {
                var data = isRandom ? WH.createRandomizedProject() : WH.createProject();
                WH.TimeBase.setBPM(data.bpm);
                WH.arrangement.setData(data.arrangement);
                WH.studio.setData(data.racks);
            },

            /**
             * Load project from localStorage.
             * @return {Boolean} True if a project was found in localstorage.
             */
            loadFromStorage = function() {
                var data = localStorage.getItem(settings.projectName);
                if (data) {
                    data = JSON.parse(data);
                    WH.TimeBase.setBPM(data.bpm);
                    WH.arrangement.setData(data.arrangement);
                    WH.studio.setData(data.racks);
                } else {
                    console.error('No data in LocalStorage with name "' + settings.projectName + '"."');
                    return false;
                }
                return true;
            },

            /**
             * Save project if autoSave is enabled.
             */
            autoSave = function() {
                if (autoSaveEnabled) {
                    save();
                }
            },

            /**
             * Collect all project data and save it in localStorage.
             */
            save = function() {

                var data = {
                    bpm: WH.TimeBase.getBPM(),
                    arrangement: WH.arrangement.getData(),
                    racks: WH.studio.getData()
                }

                localStorage.setItem(settings.projectName, JSON.stringify(data));
            };
        
        that = {};
        that.createNew = createNew;
        that.loadFromStorage = loadFromStorage;
        that.autoSave = autoSave;
        that.save = save;
        return that;
    }

    /**
     * Singleton
     */
    WH.file = createFile();
})(WH);
